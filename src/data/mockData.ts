import { Monitor, Incident, Alert, StatusPage, AuditLog, Organization, DashboardStats, Environment } from '@/types/monitor';

// Generate response history data
const generateResponseHistory = (baseTime: number, variance: number, days: number = 30) => {
  const history = [];
  const now = new Date();
  
  for (let i = days * 24; i >= 0; i--) {
    const date = new Date(now.getTime() - i * 60 * 60 * 1000);
    const status = Math.random() > 0.02 ? 'up' : 'down';
    const httpCode = status === 'up' ? (Math.random() > 0.05 ? 200 : 301) : (Math.random() > 0.5 ? 503 : 500);
    history.push({
      timestamp: date.toISOString(),
      responseTime: status === 'up' ? Math.floor(baseTime + (Math.random() - 0.5) * variance) : 0,
      status: status as 'up' | 'down',
      httpCode,
    });
  }
  
  return history;
};

// Generate uptime history bars
const generateUptimeHistory = (uptime: number, days: number = 90) => {
  const history = [];
  const now = new Date();
  
  for (let i = days; i >= 0; i--) {
    const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
    const rand = Math.random();
    let status: 'up' | 'down' | 'degraded';
    
    if (rand > (100 - uptime) / 100) {
      status = 'up';
    } else if (rand > 0.01) {
      status = 'degraded';
    } else {
      status = 'down';
    }
    
    history.push({
      date: date.toISOString().split('T')[0],
      status,
      uptime: status === 'up' ? 100 : status === 'degraded' ? 95 : 0,
    });
  }
  
  return history;
};

const getEnvironment = (tags: string[]): Environment => {
  if (tags.includes('production')) return 'production';
  if (tags.includes('uat')) return 'uat';
  if (tags.includes('staging')) return 'pre-prod';
  return 'internal';
};

const getAccountName = (tags: string[]): string => {
  if (tags.includes('dspace')) return 'DSpace Systems';
  if (tags.includes('entrez')) return 'Entrez Inc';
  return 'ABC Corp';
};

export const mockMonitors: Monitor[] = [
  {
    id: '1',
    name: 'ABC Mobile Prod',
    url: 'https://abc-mobile.example.com',
    type: 'https',
    status: 'up',
    uptime: 99.9,
    uptimeToday: 100,
    responseTime: 195,
    avgResponseTime: 179,
    minResponseTime: 145,
    maxResponseTime: 410,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-11-25',
    sslDaysRemaining: 290,
    lastChecked: new Date().toISOString(),
    createdAt: '2024-01-15',
    tags: ['production', 'mobile'],
    alertCount: 0,
    responseHistory: generateResponseHistory(195, 80),
    uptimeHistory: generateUptimeHistory(99.9),
    environment: 'production',
    accountName: 'ABC Corp',
    timezone: 'America/New_York',
    httpCode: 200,
  },
  {
    id: '2',
    name: 'ABC_Pre-Prod',
    url: 'https://abc-preprod.example.com',
    type: 'https',
    status: 'up',
    uptime: 99.8,
    uptimeToday: 100,
    responseTime: 276,
    avgResponseTime: 274,
    minResponseTime: 210,
    maxResponseTime: 452,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-11-21',
    sslDaysRemaining: 286,
    lastChecked: new Date().toISOString(),
    createdAt: '2024-01-20',
    tags: ['staging', 'web'],
    alertCount: 2,
    responseHistory: generateResponseHistory(276, 100),
    uptimeHistory: generateUptimeHistory(99.8),
    environment: 'pre-prod',
    accountName: 'ABC Corp',
    timezone: 'America/New_York',
    httpCode: 200,
  },
  {
    id: '3',
    name: 'ABC_UAT',
    url: 'https://abc-uat.example.com',
    type: 'https',
    status: 'up',
    uptime: 99.5,
    uptimeToday: 100,
    responseTime: 341,
    avgResponseTime: 368,
    minResponseTime: 295,
    maxResponseTime: 545,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-12-01',
    sslDaysRemaining: 296,
    lastChecked: new Date().toISOString(),
    createdAt: '2024-02-01',
    tags: ['uat'],
    alertCount: 1,
    responseHistory: generateResponseHistory(341, 150),
    uptimeHistory: generateUptimeHistory(99.5),
    environment: 'uat',
    accountName: 'ABC Corp',
    timezone: 'UTC',
    httpCode: 200,
  },
  {
    id: '4',
    name: 'ABCinfra4',
    url: 'https://abcinfra4.example.com',
    type: 'https',
    status: 'maintenance',
    uptime: 99.7,
    uptimeToday: 100,
    responseTime: 224,
    avgResponseTime: 245,
    minResponseTime: 180,
    maxResponseTime: 389,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-11-21',
    sslDaysRemaining: 286,
    lastChecked: new Date().toISOString(),
    createdAt: '2024-02-10',
    tags: ['infrastructure'],
    alertCount: 0,
    responseHistory: generateResponseHistory(224, 120),
    uptimeHistory: generateUptimeHistory(99.7),
    environment: 'internal',
    accountName: 'ABC Corp',
    timezone: 'UTC',
    httpCode: 200,
    maintenanceId: 'maint-1',
  },
  {
    id: '5',
    name: 'Dspace_Prod',
    url: 'https://dspace-prod.example.com',
    type: 'https',
    status: 'down',
    uptime: 98.2,
    uptimeToday: 95,
    responseTime: 0,
    avgResponseTime: 312,
    minResponseTime: 250,
    maxResponseTime: 498,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-10-15',
    sslDaysRemaining: 249,
    lastChecked: new Date().toISOString(),
    lastDowntime: new Date(Date.now() - 30 * 60 * 1000).toISOString(),
    createdAt: '2024-02-15',
    tags: ['production', 'dspace'],
    alertCount: 5,
    responseHistory: generateResponseHistory(312, 100),
    uptimeHistory: generateUptimeHistory(98.2),
    environment: 'production',
    accountName: 'DSpace Systems',
    timezone: 'America/Chicago',
    httpCode: 503,
    downtimeReason: 'Connection timeout - server not responding to health checks',
  },
  {
    id: '6',
    name: 'Pre_Five',
    url: 'https://pre-five.example.com',
    type: 'https',
    status: 'degraded',
    uptime: 99.1,
    uptimeToday: 98,
    responseTime: 856,
    avgResponseTime: 423,
    minResponseTime: 320,
    maxResponseTime: 890,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-09-20',
    sslDaysRemaining: 224,
    lastChecked: new Date().toISOString(),
    createdAt: '2024-02-20',
    tags: ['staging'],
    alertCount: 3,
    responseHistory: generateResponseHistory(423, 200),
    uptimeHistory: generateUptimeHistory(99.1),
    environment: 'pre-prod',
    accountName: 'ABC Corp',
    timezone: 'Europe/London',
    httpCode: 200,
    downtimeReason: 'High response time - performance degradation detected',
  },
  {
    id: '7',
    name: 'Dspace_UAT',
    url: 'https://dspace-uat.example.com',
    type: 'https',
    status: 'down',
    uptime: 97.5,
    uptimeToday: 92,
    responseTime: 0,
    avgResponseTime: 267,
    minResponseTime: 210,
    maxResponseTime: 412,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-11-10',
    sslDaysRemaining: 275,
    lastChecked: new Date().toISOString(),
    lastDowntime: new Date(Date.now() - 15 * 60 * 1000).toISOString(),
    createdAt: '2024-03-01',
    tags: ['uat', 'dspace'],
    alertCount: 8,
    responseHistory: generateResponseHistory(267, 90),
    uptimeHistory: generateUptimeHistory(97.5),
    environment: 'uat',
    accountName: 'DSpace Systems',
    timezone: 'America/New_York',
    httpCode: 500,
    downtimeReason: 'Internal server error - database connection failed',
  },
  {
    id: '8',
    name: 'Dspace_Pre_Prod',
    url: 'https://dspace-preprod.example.com',
    type: 'https',
    status: 'up',
    uptime: 99.6,
    uptimeToday: 100,
    responseTime: 289,
    avgResponseTime: 295,
    minResponseTime: 240,
    maxResponseTime: 420,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-12-05',
    sslDaysRemaining: 300,
    lastChecked: new Date().toISOString(),
    createdAt: '2024-03-05',
    tags: ['staging', 'dspace'],
    alertCount: 1,
    responseHistory: generateResponseHistory(289, 85),
    uptimeHistory: generateUptimeHistory(99.6),
    environment: 'pre-prod',
    accountName: 'DSpace Systems',
    timezone: 'UTC',
    httpCode: 200,
  },
  {
    id: '9',
    name: 'Dspace_Restapi',
    url: 'https://dspace-api.example.com/api',
    type: 'https',
    status: 'paused',
    uptime: 99.8,
    uptimeToday: 100,
    responseTime: 178,
    avgResponseTime: 185,
    minResponseTime: 145,
    maxResponseTime: 298,
    checkInterval: 30,
    timeout: 15,
    sslExpiry: '2026-11-28',
    sslDaysRemaining: 293,
    lastChecked: new Date().toISOString(),
    createdAt: '2024-03-10',
    tags: ['api', 'dspace'],
    alertCount: 0,
    responseHistory: generateResponseHistory(178, 60),
    uptimeHistory: generateUptimeHistory(99.8),
    environment: 'internal',
    accountName: 'DSpace Systems',
    timezone: 'America/New_York',
    httpCode: 200,
    isPaused: true,
  },
  {
    id: '10',
    name: 'Dspace_WebAPI_Prod',
    url: 'https://dspace-webapi.example.com',
    type: 'https',
    status: 'degraded',
    uptime: 99.2,
    uptimeToday: 97,
    responseTime: 654,
    avgResponseTime: 398,
    minResponseTime: 310,
    maxResponseTime: 720,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-10-30',
    sslDaysRemaining: 264,
    lastChecked: new Date().toISOString(),
    createdAt: '2024-03-15',
    tags: ['production', 'api'],
    alertCount: 4,
    responseHistory: generateResponseHistory(398, 180),
    uptimeHistory: generateUptimeHistory(99.2),
    environment: 'production',
    accountName: 'DSpace Systems',
    timezone: 'America/Chicago',
    httpCode: 200,
    downtimeReason: 'Slow response - CPU utilization at 85%',
  },
  {
    id: '11',
    name: 'Entrez_App_UAT',
    url: 'https://entrez-uat.example.com',
    type: 'https',
    status: 'up',
    uptime: 99.9,
    uptimeToday: 100,
    responseTime: 167,
    avgResponseTime: 172,
    minResponseTime: 140,
    maxResponseTime: 265,
    checkInterval: 60,
    timeout: 30,
    sslExpiry: '2026-12-15',
    sslDaysRemaining: 310,
    lastChecked: new Date().toISOString(),
    createdAt: '2024-03-20',
    tags: ['uat', 'entrez'],
    alertCount: 0,
    responseHistory: generateResponseHistory(172, 55),
    uptimeHistory: generateUptimeHistory(99.9),
    environment: 'uat',
    accountName: 'Entrez Inc',
    timezone: 'Asia/Kolkata',
    httpCode: 200,
  },
];

export const mockIncidents: Incident[] = [
  {
    id: 'inc-1',
    monitorId: '5',
    monitorName: 'Dspace_Prod',
    status: 'ongoing',
    severity: 'critical',
    title: 'Dspace Production Server Unreachable',
    description: 'The production server is not responding to health checks. All endpoints return connection timeout.',
    startedAt: new Date(Date.now() - 30 * 60 * 1000).toISOString(),
    affectedRegions: ['US-East', 'EU-West'],
    timeline: [
      {
        id: 't1',
        timestamp: new Date(Date.now() - 30 * 60 * 1000).toISOString(),
        type: 'detected',
        message: 'Automated monitoring detected server unreachable',
      },
      {
        id: 't2',
        timestamp: new Date(Date.now() - 25 * 60 * 1000).toISOString(),
        type: 'update',
        message: 'Investigating the root cause',
        user: 'John Super',
      },
    ],
  },
  {
    id: 'inc-2',
    monitorId: '7',
    monitorName: 'Dspace_UAT',
    status: 'acknowledged',
    severity: 'major',
    title: 'Dspace UAT Environment Down',
    description: 'UAT environment experiencing complete outage.',
    startedAt: new Date(Date.now() - 45 * 60 * 1000).toISOString(),
    acknowledgedAt: new Date(Date.now() - 40 * 60 * 1000).toISOString(),
    acknowledgedBy: 'Jane Admin',
    affectedRegions: ['US-West'],
    timeline: [
      {
        id: 't1',
        timestamp: new Date(Date.now() - 45 * 60 * 1000).toISOString(),
        type: 'detected',
        message: 'Monitoring detected UAT server failure',
      },
      {
        id: 't2',
        timestamp: new Date(Date.now() - 40 * 60 * 1000).toISOString(),
        type: 'acknowledged',
        message: 'Incident acknowledged and team is investigating',
        user: 'Jane Admin',
      },
    ],
  },
  {
    id: 'inc-3',
    monitorId: '6',
    monitorName: 'Pre_Five',
    status: 'resolved',
    severity: 'minor',
    title: 'High Response Time on Pre_Five',
    description: 'Response times exceeded threshold for 15 minutes.',
    startedAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
    resolvedAt: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),
    duration: 60,
    affectedRegions: ['EU-Central'],
    timeline: [
      {
        id: 't1',
        timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
        type: 'detected',
        message: 'Response time threshold exceeded',
      },
      {
        id: 't2',
        timestamp: new Date(Date.now() - 1.5 * 60 * 60 * 1000).toISOString(),
        type: 'update',
        message: 'Identified high CPU usage on backend',
        user: 'John Super',
      },
      {
        id: 't3',
        timestamp: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),
        type: 'resolved',
        message: 'Issue resolved after restarting services',
        user: 'John Super',
      },
    ],
  },
];

export const mockAlerts: Alert[] = [
  {
    id: 'alert-1',
    monitorId: '5',
    monitorName: 'Dspace_Prod',
    type: 'down',
    severity: 'critical',
    message: 'Server is not responding to health checks',
    createdAt: new Date(Date.now() - 30 * 60 * 1000).toISOString(),
    read: false,
  },
  {
    id: 'alert-2',
    monitorId: '7',
    monitorName: 'Dspace_UAT',
    type: 'down',
    severity: 'critical',
    message: 'Connection timeout after 30 seconds',
    createdAt: new Date(Date.now() - 45 * 60 * 1000).toISOString(),
    read: false,
  },
  {
    id: 'alert-3',
    monitorId: '6',
    monitorName: 'Pre_Five',
    type: 'response_time',
    severity: 'warning',
    message: 'Response time exceeded 500ms threshold',
    createdAt: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),
    read: true,
  },
  {
    id: 'alert-4',
    monitorId: '10',
    monitorName: 'Dspace_WebAPI_Prod',
    type: 'degraded',
    severity: 'warning',
    message: 'Performance degradation detected',
    createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
    read: true,
  },
  {
    id: 'alert-5',
    monitorId: '6',
    monitorName: 'Pre_Five',
    type: 'ssl_expiry',
    severity: 'info',
    message: 'SSL certificate expires in 224 days',
    createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
    read: true,
  },
];

export const mockStatusPages: StatusPage[] = [
  {
    id: 'sp-1',
    name: 'Public Status Page',
    slug: 'status',
    domain: 'status.uptimehost.com',
    isPublic: true,
    monitors: ['1', '2', '5', '8'],
    theme: 'auto',
    headerText: 'UptimeHost System Status',
    footerText: 'Â© 2024 UptimeHost Inc. All rights reserved.',
    createdAt: '2024-01-20',
    updatedAt: '2024-02-01',
  },
  {
    id: 'sp-2',
    name: 'Internal Status',
    slug: 'internal',
    isPublic: false,
    monitors: ['3', '4', '6', '7', '9', '10', '11'],
    theme: 'dark',
    headerText: 'Internal Systems Status',
    createdAt: '2024-02-15',
    updatedAt: '2024-02-20',
  },
];

export const mockAuditLogs: AuditLog[] = [
  {
    id: 'log-1',
    userId: '1',
    userName: 'John Super',
    userEmail: 'superadmin@uptimehost.com',
    action: 'monitor.create',
    resource: 'Monitor',
    resourceId: '11',
    details: 'Created monitor "Entrez_App_UAT"',
    ipAddress: '192.168.1.100',
    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',
    timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
  },
  {
    id: 'log-2',
    userId: '2',
    userName: 'Jane Admin',
    userEmail: 'admin@uptimehost.com',
    action: 'incident.acknowledge',
    resource: 'Incident',
    resourceId: 'inc-2',
    details: 'Acknowledged incident for Dspace_UAT',
    ipAddress: '192.168.1.105',
    userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)',
    timestamp: new Date(Date.now() - 40 * 60 * 1000).toISOString(),
  },
  {
    id: 'log-3',
    userId: '1',
    userName: 'John Super',
    userEmail: 'superadmin@uptimehost.com',
    action: 'user.invite',
    resource: 'User',
    resourceId: '4',
    details: 'Invited new user with role "viewer"',
    ipAddress: '192.168.1.100',
    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',
    timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
  },
  {
    id: 'log-4',
    userId: '1',
    userName: 'John Super',
    userEmail: 'superadmin@uptimehost.com',
    action: 'settings.update',
    resource: 'Organization',
    resourceId: 'org-1',
    details: 'Updated notification preferences',
    ipAddress: '192.168.1.100',
    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',
    timestamp: new Date(Date.now() - 48 * 60 * 60 * 1000).toISOString(),
  },
  {
    id: 'log-5',
    userId: '2',
    userName: 'Jane Admin',
    userEmail: 'admin@uptimehost.com',
    action: 'monitor.update',
    resource: 'Monitor',
    resourceId: '5',
    details: 'Updated check interval from 60s to 30s',
    ipAddress: '192.168.1.105',
    userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)',
    timestamp: new Date(Date.now() - 72 * 60 * 60 * 1000).toISOString(),
  },
];

export const mockOrganization: Organization = {
  id: 'org-1',
  name: 'UptimeHost Inc.',
  slug: 'uptimehost',
  plan: 'business',
  monitorsLimit: 100,
  monitorsUsed: 11,
  usersLimit: 25,
  usersCount: 8,
  createdAt: '2024-01-01',
};

export const getDashboardStats = (): DashboardStats => {
  const monitors = mockMonitors;
  const up = monitors.filter(m => m.status === 'up').length;
  const down = monitors.filter(m => m.status === 'down').length;
  const degraded = monitors.filter(m => m.status === 'degraded').length;
  const paused = monitors.filter(m => m.status === 'paused' || m.isPaused).length;
  const maintenance = monitors.filter(m => m.status === 'maintenance').length;
  const activeIncidents = mockIncidents.filter(i => i.status !== 'resolved').length;
  
  const avgResponse = monitors
    .filter(m => m.status !== 'down' && m.status !== 'paused')
    .reduce((sum, m) => sum + m.responseTime, 0) / (monitors.length - down - paused) || 0;
  
  const overallUptime = monitors.reduce((sum, m) => sum + m.uptime, 0) / monitors.length;

  return {
    totalMonitors: monitors.length,
    monitorsUp: up,
    monitorsDown: down,
    monitorsDegraded: degraded,
    monitorsPaused: paused,
    monitorsMaintenance: maintenance,
    avgResponseTime: Math.round(avgResponse),
    totalIncidents: mockIncidents.length,
    activeIncidents,
    overallUptime: Math.round(overallUptime * 10) / 10,
  };
};
